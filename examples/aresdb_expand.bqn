# Expand Link: https://github.com/uber/aresdb/blob/a8d2aedc6850b10a6cc9381ba780800290b2756d/query/sort_reduce.cu#L252
# Test Link:   https://github.com/uber/aresdb/blob/a8d2aedc6850b10a6cc9381ba780800290b2756d/query/algorithm_unittest.cu#L1747

u  â‡ â€¢Import "/home/cph/bqn-test/test.bqn"
fn â‡ â€¢Import "/home/cph/bqn-code/lib/fun.bqn"

IrrChunk â† { 1â†“ğ•©âŠ”Ëœ1+ğ•¨/â†•â‰ ğ•¨ } # irregular chunk

Expand â† { ğ•Š idvâ€¿idxâ€¿bcâ€¿dâ€¿nâ€¿c: # inputDimValuesâ€¿inputIndexâ€¿baseCountsâ€¿dimsâ€¿lenâ€¿cap
    m â† idxâŠfn.Deltas bc # mask
    âˆ¾âˆ¾d{ câ†‘m/ğ•¨ fn.Chunk ğ•© }Â¨idv IrrChunkËœnÃ—d
}

# Tests
inputDimValues â† âŸ¨
    1, 0, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, 0,
    1, 0, 2, 0, 3, 0, 2, 0, 3, 0, 1, 0,
    1, 2, 3, 2, 3, 1,
    1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1
âŸ©
inputIndex â† âŸ¨1, 2, 4, 7, 9, 12âŸ©
baseCounts â† âŸ¨0, 0, 1, 3, 4, 7, 8, 10, 13, 14, 16, 19, 22, 23, 26, 30âŸ©
expectedDimValues â† âŸ¨
    1, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0,
    3, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0,
    1, 0, 2, 0, 2, 0, 3, 0, 3, 0, 3, 0, 2, 0, 2, 0, 2, 0, 3, 0,
    1, 2, 2, 3, 3, 3, 2, 2, 2, 3,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
âŸ©

dims â† 4â€¿2â€¿1â€¿1â€¿1â€¿1
len  â† 6
cap  â† 10

u.UnitTest (Expand âŸ¨inputDimValues, inputIndex, baseCounts, dims, len, capâŸ©) â‰¡ expectedDimValues
