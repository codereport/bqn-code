u  â‡ â€¢Import "/home/cph/bqn-test/test.bqn"
h  â‡ â€¢Import "/home/cph/bqn-code/lib/helper.bqn"
fn â‡ â€¢Import "/home/cph/bqn-code/lib/fun.bqn"

miniInput â† â€¢pathâˆ¾"/data/12-mini.txt"
testInput â† â€¢pathâˆ¾"/data/12-test.txt"
input     â† â€¢pathâˆ¾"/data/12.txt"

# Parsing
Parse â† >â€¢file.Lines

# Solutions
FloodFill â† { gğ•Špsâ€¿upâ€¿f: # positionsâ€¿fence
    nâ€¿p  â† (âŠ‘âŸœgâŠ¸â‹ˆ) âŠ‘up
    next â† (Â¬âˆŠâŸœps)âŠ¸/pâŠ¸+Â¨h.del4
    m1   â† gâŠ¸h.IbÂ¨next            # mask 1
    in   â† m1âŠ¸/next               # pos in bounds
    m2   â† { Ã—â‰ in ? n=inâŠ‘g ; âŸ¨âŸ© } # mask 2
    nf   â† f++Â´m1(âˆ¾â—‹Â¬)m2          # new fence
    nps  â† âˆ§psâˆ¾â‹ˆp                 # new positions
    { (1<â‰ up)âˆ¨Ã—+Â´m2  ? g FloodFill âŸ¨nps,â·(1â†“up)âˆ¾m2/in,nfâŸ© ; npsâ€¿nf }
}

Plots â† { â· ğ•©âŠ¸FloodFillÂ¨{(â‹ˆâŸ¨âŸ©)âˆ¾0â‹ˆËœâ‹ˆğ•©}Â¨fn.I 'A'â‰¤ğ•© }
A     â† +Â´Â·â‰ âŠ¸Ã—Â´Â¨Plots

sq    â† âŸ¨âŸ¨âŸ¨0,0âŸ©,âŸ¨1,0âŸ©,âŸ¨1,1âŸ©,âŸ¨0,1âŸ©âŸ©,âŸ¨âŸ¨0,0âŸ©,âŸ¨0,1âŸ©,âŸ¨Â¯1,1âŸ©,âŸ¨Â¯1,0âŸ©âŸ©,âŸ¨âŸ¨0,0âŸ©,âŸ¨Â¯1,0âŸ©,âŸ¨Â¯1,Â¯1âŸ©,âŸ¨0,Â¯1âŸ©âŸ©,âŸ¨âŸ¨0,0âŸ©,âŸ¨0,Â¯1âŸ©,âŸ¨1,Â¯1âŸ©,âŸ¨1,0âŸ©âŸ©âŸ©
cp    â† 'x'=âˆ¾âŸ¨â‹ˆ"xx.x",(â†•4)âŒ½Â¨<"x...",(â†•2)âŒ½Â¨<"x.x."âŸ© # corner patterns
Sides â† { +Â´(cpâ‰¡âš‡1ËœâŠ¢)Â¨((ğ•¨âŠ¸h.Ib)â—¶âŸ¨0,ğ•©=â—‹(âŠ‘âŸœğ•¨)âŠ¢âŸ©Â¨ğ•©âŠ¸+Â¨)Â¨sq }
B     â† { +Â´(â‰ Ã—(+Â´Â·âˆ¾ğ•©âŠ¸SidesÂ¨))Â¨âŠ‘Â¨Plotsğ•© }

# Test
u.UnitTest (A Parse miniInput) â‰¡ 140
u.UnitTest (A Parse testInput) â‰¡ 1930
# u.UnitTest (A Parse input)   â‰¡ 1374934
u.UnitTest (B Parse miniInput) â‰¡ 80
u.UnitTest (B Parse testInput) â‰¡ 1206
# u.UnitTest (B Parse input)   â‰¡ 841078
